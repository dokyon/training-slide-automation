# ナレーション生成ツール - 使い方ガイド

## 概要

このツールは、**プログラミング知識不要**でテキストから高品質な音声ナレーションを生成できるシステムです。

- **Google Gemini 2.5 Flash Preview TTS** を使用
- **辞書機能**で専門用語の読み方を制御
- **対話的なCLI**で簡単操作

---

## セットアップ（初回のみ）

### 1. APIキーの設定

`.env` ファイルに Gemini API キーを設定:

```bash
GEMINI_API_KEY=your_api_key_here
GEMINI_PAID_TIER=true
```

### 2. 必要なツールの確認

```bash
# ffmpegがインストールされているか確認
ffmpeg -version

# インストールされていない場合
brew install ffmpeg
```

---

## 使い方

### 📝 シンプルなテキスト→ナレーション生成

**コマンド:**
```bash
npm run tts
```

**使い方:**

1. コマンドを実行
2. 入力方法を選択:
   - `1`: テキストを直接入力
   - `2`: テキストファイルから読み込み
3. テキストを入力（直接入力の場合、空行でEnter）
4. 出力ファイル名を入力（例: `my_narration`）
5. 生成完了！

**出力先:**
```
./output/narration/your_filename.mp3
```

**例:**

```bash
$ npm run tts

===========================================
  ナレーション生成ツール
===========================================

📝 入力方法を選択してください:
  1. テキストを直接入力
  2. テキストファイルから読み込み

番号を入力 (1 or 2): 1

📝 ナレーション用のテキストを入力してください。
   (入力完了後、空行でEnterを押してください)

こんにちは。これはテストです。
ChatGPTを使った研修について説明します。

💾 出力ファイル名を入力 (拡張子なし): test_intro

===========================================
  生成開始
===========================================

📊 テキスト長: 45文字
💾 出力ファイル: test_intro.mp3

🔧 Mode: Paid tier

🎙️  Generating audio...

✅ Audio saved: ./output/narration/test_intro.mp3

===========================================
  ✅ 生成完了！
===========================================

📁 出力先: ./output/narration/test_intro.mp3
```

---

### 📖 辞書管理（専門用語の読み方を登録）

**コマンド:**
```bash
npm run dict
```

**機能:**

1. **ワード一覧を表示** - 登録されている全ワードを確認
2. **ワードを追加** - 新しいワードと読み方を登録
3. **ワードを削除** - 不要なワードを削除
4. **ワードを検索** - キーワードでワードを検索
5. **終了**

**例: ワードを追加**

```bash
$ npm run dict

🎙️  ナレーション辞書管理ツール

📖 辞書ファイル: ./src/narration/dictionary.json
📊 登録ワード数: 25

===========================================
  辞書管理ツール
===========================================

1. ワード一覧を表示
2. ワードを追加
3. ワードを削除
4. ワードを検索
5. 終了

番号を選択: 2

===========================================
  ワードを追加
===========================================

📝 元のワード（例: ChatGPT）: Notion
🔊 読み方（例: チャットジーピーティー）: ノーション

✅ 辞書を保存しました。

✅ "Notion" → "ノーション" を追加しました。
```

**例: ワードを検索**

```bash
番号を選択: 4

===========================================
  ワードを検索
===========================================

🔍 検索キーワード: GPT

✅ 2 件見つかりました:

1. "ChatGPT" → "チャットジーピーティー"
2. "GPT" → "ジーピーティー"
```

---

### 📚 台本全体からナレーション生成（JSON形式）

大量のセクションを一括生成する場合はこちら。

**コマンド:**
```bash
npm run narration scripts/your_script.json
```

**JSONフォーマット例:**

```json
{
  "title": "第1章: ChatGPTとの対話",
  "duration": "110分",
  "branding": {
    "company": "Stella株式会社",
    "logo": "",
    "primaryColor": "5FB8A6"
  },
  "sections": [
    {
      "type": "content",
      "title": "1-1-1. ChatGPTの登場",
      "narration": "ChatGPTは2022年11月に登場した...",
      "bullets": [
        "AIチャットボットの革命",
        "誰でも使える対話型AI"
      ]
    }
  ]
}
```

---

## 辞書の使い方

### 辞書とは？

AIは専門用語や固有名詞を誤って読むことがあります。例:

- ❌ "ChatGPT" → "チャットジーピーティー" ではなく "チャットグプト"
- ❌ "API" → "エーピーアイ" ではなく "アピ"

**辞書機能**を使うと、読み方を事前に指定できます。

### 既に登録されているワード（一部）

```
ChatGPT → チャットジーピーティー
AI → エーアイ
OpenAI → オープンエーアイ
LLM → エルエルエム
API → エーピーアイ
SaaS → サース
Excel → エクセル
PDF → ピーディーエフ
...
```

### 辞書の追加方法

**方法1: CLIツールを使う（推奨）**

```bash
npm run dict
```

選択肢 `2. ワードを追加` を選んで対話的に登録。

**方法2: JSONファイルを直接編集**

プログラミングに慣れている場合、以下のファイルを直接編集:

```
src/narration/dictionary.json
```

---

## 有料プラン vs 無料プラン

### 無料プラン（Free tier）

- **制限:** 1日15リクエスト
- **待機時間:** 35秒/リクエスト
- **速度:** 遅い
- **コスト:** 0円

### 有料プラン（Paid tier）

- **制限:** なし（実質無制限）
- **待機時間:** 1秒/リクエスト
- **速度:** 35倍速
- **コスト:** 1章（約23セクション）で約45円

### プランの切り替え

`.env` ファイルで設定:

```bash
# 有料プラン（デフォルト）
GEMINI_PAID_TIER=true

# 無料プラン
GEMINI_PAID_TIER=false
```

---

## トラブルシューティング

### エラー: `GEMINI_API_KEY environment variable is required`

`.env` ファイルに API キーを設定してください:

```bash
GEMINI_API_KEY=your_api_key_here
```

### エラー: `ffmpeg not found`

ffmpegをインストールしてください:

```bash
brew install ffmpeg
```

### エラー: `You exceeded your current quota`

無料プランの1日15リクエスト制限に達しました。

**解決方法:**
1. 翌日まで待つ（日本時間 0:00 にリセット）
2. 有料プランに切り替える（`.env` で `GEMINI_PAID_TIER=true`）

### 音声の読み方が間違っている

辞書にワードを追加してください:

```bash
npm run dict
```

選択肢 `2. ワードを追加` で読み方を登録。

---

## コマンド一覧

| コマンド | 説明 |
|---------|------|
| `npm run tts` | テキスト入力→ナレーション生成（シンプル版） |
| `npm run dict` | 辞書管理ツール（ワード追加・削除・検索） |
| `npm run narration <json>` | JSON台本から一括ナレーション生成 |

---

## ファイル構成

```
training-slide-automation/
├── src/
│   ├── simple-narration-cli.ts       # シンプルなナレーション生成CLI
│   ├── dictionary-manager-cli.ts     # 辞書管理CLI
│   ├── narration-cli.ts              # 台本一括生成CLI
│   └── narration/
│       ├── narration-generator.ts    # ナレーション生成エージェント
│       └── dictionary.json           # 辞書ファイル
├── scripts/
│   └── chapter1-detailed.json        # 台本例（JSON形式）
├── output/
│   └── narration/                    # 生成されたMP3ファイル
├── .env                              # API設定
└── NARRATION_GUIDE.md                # このファイル
```

---

## よくある質問

### Q1: 生成されたMP3ファイルはどこにありますか？

`./output/narration/` フォルダに保存されます。

Finderで開く:
```bash
open ./output/narration
```

### Q2: 生成速度はどれくらいですか？

- **無料プラン:** 1ファイル約40秒（待機時間含む）
- **有料プラン:** 1ファイル約3-5秒

### Q3: 辞書に登録できるワード数に制限はありますか？

制限はありません。何個でも登録できます。

### Q4: 生成された音声の品質は？

- **サンプルレート:** 24kHz
- **形式:** MP3 (128kbps)
- **声質:** Puck（30代男性、明るくフレッシュ）

### Q5: 複数の音声を一度に生成できますか？

はい。`npm run narration scripts/your_script.json` で台本全体を一括生成できます。

---

## サポート

問題が発生した場合は、以下を確認してください:

1. `.env` ファイルに API キーが設定されているか
2. ffmpeg がインストールされているか
3. 無料プランの制限（15リクエスト/日）に達していないか

それでも解決しない場合は、エラーメッセージをコピーして報告してください。
